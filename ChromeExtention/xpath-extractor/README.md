# XPath Pattern Extractor

Webページ上の要素をクリックして、DOM構造のパターンを自動認識し、テキストデータを配列として抽出するChrome拡張機能です。

## 機能概要

- **段階的パターン認識**: 1回目のクリックで単一要素、2回目で1次元配列（リスト）、3回目で2次元配列（テーブル）のパターンを自動検出
- **ビジュアルフィードバック**: 選択要素は黄色、パターン一致要素は緑色でハイライト表示
- **XPath自動生成**: クリックした要素から自動的にXPathを生成
- **データ抽出**: パターンに基づいて全要素のテキストを抽出し、クリップボードにコピー可能

## インストール手順

### 開発者モードでのインストール

1. このリポジトリをダウンロードまたはクローン
   ```bash
   git clone <repository-url>
   ```
   または、ZIPファイルをダウンロードして解凍

2. Chrome ブラウザで `chrome://extensions/` を開く

3. 右上の「デベロッパーモード」をオンにする

4. 「パッケージ化されていない拡張機能を読み込む」をクリック

5. ダウンロードした `xpath-extractor` フォルダを選択

6. 拡張機能がインストールされ、ツールバーにアイコンが表示されます

### アイコンの準備

拡張機能には以下のサイズのPNGアイコンが必要です：
- `icons/icon16.png` (16x16px)
- `icons/icon48.png` (48x48px)
- `icons/icon128.png` (128x128px)

サンプルアイコンを使用するか、独自のアイコンを作成してください。

## 使用方法

### 基本操作

1. **選択モードの開始**
   - 拡張機能アイコンをクリックしてポップアップを開く
   - 「選択開始」ボタンをクリック
   - または、キーボードショートカット `Ctrl+Shift+E` (Mac: `Command+Shift+E`)

2. **要素の選択**
   - 選択モード中、ページ上の要素をクリックすると黄色でハイライト
   - カーソルがクロスヘアに変わります

3. **パターン認識**
   - **1要素目**: 単一要素として選択
   - **2要素目**: 1つ目と構造を比較し、同じ階層の異なる要素であれば1次元配列として認識（例: リストの項目）
   - **3要素目以降**: 行内の異なる列を検出した場合、2次元配列として認識（例: テーブルのセル）

4. **選択解除**
   - 選択済みの要素をダブルクリックで個別に解除
   - `Esc` キーで全選択を解除し、選択モードを終了

5. **データの取得**
   - ポップアップでリアルタイムに抽出データを確認
   - 「コピー」ボタンでクリップボードにコピー
   - 「クリア」ボタンで全てリセット

### パターン認識の例

#### 1次元配列（リスト）

```html
<ul>
  <li>項目1</li>  <!-- 1回目クリック -->
  <li>項目2</li>  <!-- 2回目クリック → リスト全体を検出 -->
  <li>項目3</li>
</ul>
```

検出されるXPathパターン: `/html/body/.../ul/li[*]`

抽出データ:
```
項目1
項目2
項目3
```

#### 2次元配列（テーブル）

```html
<table>
  <tr>
    <td>A1</td>  <!-- 1回目クリック -->
    <td>B1</td>  <!-- 3回目クリック → 行と列を認識 -->
  </tr>
  <tr>
    <td>A2</td>  <!-- 2回目クリック → 行パターンを認識 -->
    <td>B2</td>
  </tr>
</table>
```

検出されるXPathパターン: `/html/body/.../table/tbody/tr[*]/td[*]`

抽出データ（タブ区切り）:
```
A1	B1
A2	B2
```

## キーボードショートカット

| ショートカット | 動作 |
|--------------|------|
| `Ctrl+Shift+E` (Mac: `Command+Shift+E`) | 選択モードのトグル |
| `Esc` | 選択モードの終了と全選択解除 |
| ダブルクリック | 個別の選択解除 |

## 技術的な制約

- **iframe内の要素**: 現バージョンでは非対応
- **Shadow DOM内の要素**: 現バージョンでは非対応
- **非表示要素**: 選択可能ですがハイライト表示されません

## ファイル構成

```
xpath-extractor/
├── manifest.json      # 拡張機能の設定ファイル
├── background.js      # Service Worker（コマンド処理）
├── content.js         # コンテンツスクリプト（メインロジック）
├── popup.html         # ポップアップUI
├── popup.js           # ポップアップのロジック
├── styles.css         # ハイライト用スタイル
├── README.md          # このファイル
└── icons/
    ├── icon16.png
    ├── icon48.png
    └── icon128.png
```

## トラブルシューティング

### 選択モードが開始しない
- ページをリロードしてみてください
- 拡張機能を再読み込み（`chrome://extensions/` で更新ボタン）

### ハイライトが表示されない
- ページのCSSが競合している可能性があります
- `z-index` が高い要素の上では表示されないことがあります

### パターンが認識されない
- 選択する要素の構造が大きく異なる場合、パターン認識に失敗します
- 同じ階層の類似要素を選択してください

## ライセンス

MIT License

## 更新履歴

### v1.0.0
- 初回リリース
- 基本的な要素選択機能
- 1次元・2次元パターン認識
- データ抽出とコピー機能
